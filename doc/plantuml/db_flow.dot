digraph db_flow {
  rankdir=TB;
  graph [fontname="Arial"];
  node [fontname="Arial", shape=record];

  subgraph cluster_db {
    label="Database / Persistence";
    style=rounded;
    db [label="DB\n(事务/索引/锁)", shape=cylinder, fillcolor="#F0E6FF", style=filled, color="#5A67D8"];
    tx [label="Transactional Writes\n(commit/rollback)", shape=box, fillcolor="#EDF2F7", style=filled];
    idx [label="Indexes\n(read/write cost)", shape=note, fillcolor="#FFF7E6", style=filled];
    slowq [label="Slow Queries / Locks", shape=diamond, color="#C53030"];
  }

  app [label="Consumer Batch Writer", shape=box, fillcolor="#E6F2FF", style=filled];
  cache [label="Cache (optional)\ninvalidate/write-through", shape=component, fillcolor="#FFFBE6", style=filled];

  app -> tx -> db;
  tx -> idx [style=dashed, color="#4A5568"];
  tx -> slowq [style=dotted, color="#C53030"];
  app -> cache [label="update/invalidate", style=dashed, color="#4A5568"];

  // notes
  note1 [label="Best practices:\n- Use batched transactions\n- Monitor 95/99 latency\n- Keep indexes minimal for writes", shape=note, fontsize=10];
  db -> note1 [style=dashed, arrowhead=none, color="#4A5568"];
}
