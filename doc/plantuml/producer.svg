<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1064px" preserveAspectRatio="none" style="width:2316px;height:1064px;background:#FFFFFF;" version="1.1" viewBox="0 0 2316 1064" width="2316px" zoomAndPan="magnify"><title>Producer sendWithRetry sequence (cdmp-mini)</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="374.5684" x="974.8401" y="27.9951">Producer sendWithRetry sequence (cdmp-mini)</text><rect fill="none" height="531.6719" style="stroke:#000000;stroke-width:1.5;" width="1672.8149" x="109.5498" y="294.2578"/><rect fill="none" height="398.3359" style="stroke:#000000;stroke-width:1.5;" width="1652.8149" x="119.5498" y="376.6563"/><rect fill="none" height="177.6016" style="stroke:#000000;stroke-width:1.5;" width="1632.8149" x="129.5498" y="561.2578"/><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="865.3984" width="8" x="24.2651" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="28" x2="28" y1="118.5938" y2="983.9922"/></g><g><title>Gin Handler</title><rect fill="#000000" fill-opacity="0.00000" height="865.3984" width="8" x="184.1431" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="187.5498" x2="187.5498" y1="118.5938" y2="983.9922"/></g><g><title>UserProducer.sendUserMessage</title><rect fill="#000000" fill-opacity="0.00000" height="865.3984" width="8" x="462.5571" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="465.6138" x2="465.6138" y1="118.5938" y2="983.9922"/></g><g><title>UserProducer.sendWithRetry</title><rect fill="#000000" fill-opacity="0.00000" height="865.3984" width="8" x="700.792" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="704.5005" x2="704.5005" y1="118.5938" y2="983.9922"/></g><g><title>inFlightSem .channel.</title><rect fill="#000000" fill-opacity="0.00000" height="865.3984" width="8" x="902.9604" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="906.0835" x2="906.0835" y1="118.5938" y2="983.9922"/></g><g><title>kafka.Writer.WriteMessages</title><rect fill="#000000" fill-opacity="0.00000" height="865.3984" width="8" x="1102.2339" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1105.8374" x2="1105.8374" y1="118.5938" y2="983.9922"/></g><g><title>UserProducer.sendToRetryTopic</title><rect fill="#000000" fill-opacity="0.00000" height="865.3984" width="8" x="1337.2285" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1340.6304" x2="1340.6304" y1="118.5938" y2="983.9922"/></g><g><title>UserProducer.SendToDeadLetterTopic</title><rect fill="#000000" fill-opacity="0.00000" height="865.3984" width="8" x="1607.5957" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1610.8267" x2="1610.8267" y1="118.5938" y2="983.9922"/></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="5" y="115.292">Client</text><ellipse cx="28.2651" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M28.2651,58.7969 L28.2651,85.7969 M15.2651,66.7969 L41.2651,66.7969 M28.2651,85.7969 L15.2651,100.7969 M28.2651,85.7969 L41.2651,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="5" y="995.9873">Client</text><ellipse cx="28.2651" cy="1007.7891" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M28.2651,1015.7891 L28.2651,1042.7891 M15.2651,1023.7891 L41.2651,1023.7891 M28.2651,1042.7891 L15.2651,1057.7891 M28.2651,1042.7891 L41.2651,1057.7891" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Handler"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97.1865" x="139.5498" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.1865" x="146.5498" y="107.292">Gin Handler</text></g><g class="participant participant-tail" data-participant="Handler"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97.1865" x="139.5498" y="982.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.1865" x="146.5498" y="1002.9873">Gin Handler</text></g><g class="participant participant-head" data-participant="SendUserMessage"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="239.8867" x="346.6138" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="225.8867" x="353.6138" y="107.292">UserProducer.sendUserMessage</text></g><g class="participant participant-tail" data-participant="SendUserMessage"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="239.8867" x="346.6138" y="982.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="225.8867" x="353.6138" y="1002.9873">UserProducer.sendUserMessage</text></g><g class="participant participant-head" data-participant="SendWithRetry"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="216.583" x="596.5005" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202.583" x="603.5005" y="107.292">UserProducer.sendWithRetry</text></g><g class="participant participant-tail" data-participant="SendWithRetry"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="216.583" x="596.5005" y="982.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202.583" x="603.5005" y="1002.9873">UserProducer.sendWithRetry</text></g><g class="participant participant-head" data-participant="InFlight"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="167.7539" x="823.0835" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153.7539" x="830.0835" y="107.292">inFlightSem (channel)</text></g><g class="participant participant-tail" data-participant="InFlight"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="167.7539" x="823.0835" y="982.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153.7539" x="830.0835" y="1002.9873">inFlightSem (channel)</text></g><g class="participant participant-head" data-participant="KafkaWrite"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="210.793" x="1000.8374" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196.793" x="1007.8374" y="107.292">kafka.Writer.WriteMessages</text></g><g class="participant participant-tail" data-participant="KafkaWrite"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="210.793" x="1000.8374" y="982.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196.793" x="1007.8374" y="1002.9873">kafka.Writer.WriteMessages</text></g><g class="participant participant-head" data-participant="SendRetry"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="239.1963" x="1221.6304" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="225.1963" x="1228.6304" y="107.292">UserProducer.sendToRetryTopic</text></g><g class="participant participant-tail" data-participant="SendRetry"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="239.1963" x="1221.6304" y="982.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="225.1963" x="1228.6304" y="1002.9873">UserProducer.sendToRetryTopic</text></g><g class="participant participant-head" data-participant="DeadLetter"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="281.5381" x="1470.8267" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="267.5381" x="1477.8267" y="107.292">UserProducer.SendToDeadLetterTopic</text></g><g class="participant participant-tail" data-participant="DeadLetter"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="281.5381" x="1470.8267" y="982.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="267.5381" x="1477.8267" y="1002.9873">UserProducer.SendToDeadLetterTopic</text></g><g class="message" data-participant-1="Client" data-participant-2="Handler"><polygon fill="#181818" points="176.1431,145.7266,186.1431,149.7266,176.1431,153.7266,180.1431,149.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="28.2651" x2="182.1431" y1="149.7266" y2="149.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.8779" x="35.2651" y="144.6606">HTTP POST /v1/users</text></g><g class="message" data-participant-1="Handler" data-participant-2="SendUserMessage"><polygon fill="#181818" points="454.5571,174.8594,464.5571,178.8594,454.5571,182.8594,458.5571,178.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="188.1431" x2="460.5571" y1="178.8594" y2="178.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254.4141" x="195.1431" y="173.7935">serialize user -&gt; call sendUserMessage</text></g><g class="message" data-participant-1="SendUserMessage" data-participant-2="SendWithRetry"><polygon fill="#181818" points="692.792,203.9922,702.792,207.9922,692.792,211.9922,696.792,207.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="466.5571" x2="698.792" y1="207.9922" y2="207.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.9629" x="473.5571" y="202.9263">prepare kafka.Message</text></g><g class="message" data-participant-1="SendWithRetry" data-participant-2="SendWithRetry"><line style="stroke:#181818;stroke-width:1;" x1="704.792" x2="746.792" y1="237.125" y2="237.125"/><line style="stroke:#181818;stroke-width:1;" x1="746.792" x2="746.792" y1="237.125" y2="250.125"/><line style="stroke:#181818;stroke-width:1;" x1="705.792" x2="746.792" y1="250.125" y2="250.125"/><polygon fill="#181818" points="715.792,246.125,705.792,250.125,715.792,254.125,711.792,250.125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.3169" x="711.792" y="232.0591">validateMessage()</text></g><g class="message" data-participant-1="SendWithRetry" data-participant-2="InFlight"><polygon fill="#181818" points="894.9604,275.2578,904.9604,279.2578,894.9604,283.2578,898.9604,279.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="704.792" x2="900.9604" y1="279.2578" y2="279.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.8223" x="711.792" y="274.1919">try acquire (non-blocking)</text></g><path d="M109.5498,294.2578 L173.9927,294.2578 L173.9927,301.3906 L163.9927,311.3906 L109.5498,311.3906 L109.5498,294.2578" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="531.6719" style="stroke:#000000;stroke-width:1.5;" width="1672.8149" x="109.5498" y="294.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="124.5498" y="307.3247">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="64.2329" x="188.9927" y="306.4683">[acquired]</text><path d="M1787.3647,299.2578 L1787.3647,369.2578 L2309.3647,369.2578 L2309.3647,309.2578 L2299.3647,299.2578 L1787.3647,299.2578" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2299.3647,299.2578 L2299.3647,309.2578 L2309.3647,309.2578 L2299.3647,299.2578" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6553" x="1793.3647" y="316.3247">Key points:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="473.4209" x="1793.3647" y="331.4575">- inFlightSem provides synchronous backpressure: non-blocking acquire.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="403.7236" x="1793.3647" y="346.5903">- On writer failure, message goes to retry topic or dead-letter.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="501.8838" x="1793.3647" y="361.7231">- Metrics (ProducerInFlightCurrent, ProducerFailures) updated along the way.</text><g class="message" data-participant-1="InFlight" data-participant-2="SendWithRetry"><polygon fill="#181818" points="715.792,328.5234,705.792,332.5234,715.792,336.5234,711.792,332.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="709.792" x2="905.9604" y1="332.5234" y2="332.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36.8164" x="721.792" y="327.4575">token</text></g><g class="message" data-participant-1="SendWithRetry" data-participant-2="KafkaWrite"><polygon fill="#181818" points="1094.2339,357.6563,1104.2339,361.6563,1094.2339,365.6563,1098.2339,361.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="704.792" x2="1100.2339" y1="361.6563" y2="361.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.3022" x="711.792" y="356.5903">WriteMessages(sendMsg)</text></g><path d="M119.5498,376.6563 L183.9927,376.6563 L183.9927,383.7891 L173.9927,393.7891 L119.5498,393.7891 L119.5498,376.6563" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="398.3359" style="stroke:#000000;stroke-width:1.5;" width="1652.8149" x="119.5498" y="376.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="134.5498" y="389.7231">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="58.0293" x="198.9927" y="388.8667">[success]</text><g class="message" data-participant-1="KafkaWrite" data-participant-2="SendWithRetry"><polygon fill="#181818" points="715.792,410.9219,705.792,414.9219,715.792,418.9219,711.792,414.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="709.792" x2="1105.2339" y1="414.9219" y2="414.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.5898" x="721.792" y="409.856">nil (success)</text></g><g class="message" data-participant-1="SendWithRetry" data-participant-2="Handler"><polygon fill="#181818" points="199.1431,440.0547,189.1431,444.0547,199.1431,448.0547,195.1431,444.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="193.1431" x2="703.792" y1="444.0547" y2="444.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.2466" x="205.1431" y="438.9888">return success</text></g><g class="message" data-participant-1="SendWithRetry" data-participant-2="InFlight"><polygon fill="#181818" points="894.9604,469.1875,904.9604,473.1875,894.9604,477.1875,898.9604,473.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="704.792" x2="900.9604" y1="473.1875" y2="473.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.6899" x="711.792" y="468.1216">release</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="119.5498" x2="1772.3647" y1="482.1875" y2="482.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="50.5205" x="124.5498" y="492.3979">[failure]</text><g class="message" data-participant-1="KafkaWrite" data-participant-2="SendWithRetry"><polygon fill="#181818" points="715.792,513.125,705.792,517.125,715.792,521.125,711.792,517.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="709.792" x2="1105.2339" y1="517.125" y2="517.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.9858" x="721.792" y="512.0591">error</text></g><g class="message" data-participant-1="SendWithRetry" data-participant-2="SendRetry"><polygon fill="#181818" points="1329.2285,542.2578,1339.2285,546.2578,1329.2285,550.2578,1333.2285,546.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="704.792" x2="1335.2285" y1="546.2578" y2="546.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.0127" x="711.792" y="541.1919">sendToRetryTopic(msg, err)</text></g><path d="M129.5498,561.2578 L193.9927,561.2578 L193.9927,568.3906 L183.9927,578.3906 L129.5498,578.3906 L129.5498,561.2578" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="177.6016" style="stroke:#000000;stroke-width:1.5;" width="1632.8149" x="129.5498" y="561.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="144.5498" y="574.3247">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="140.4165" x="208.9927" y="573.4683">[sendToRetry success]</text><g class="message" data-participant-1="SendRetry" data-participant-2="SendWithRetry"><polygon fill="#181818" points="715.792,595.5234,705.792,599.5234,715.792,603.5234,711.792,599.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="709.792" x2="1340.2285" y1="599.5234" y2="599.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15.4629" x="721.792" y="594.4575">nil</text></g><g class="message" data-participant-1="SendWithRetry" data-participant-2="Handler"><polygon fill="#181818" points="199.1431,624.6563,189.1431,628.6563,199.1431,632.6563,195.1431,628.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="193.1431" x2="703.792" y1="628.6563" y2="628.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.0088" x="205.1431" y="623.5903">success (via retry)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="129.5498" x2="1762.3647" y1="637.6563" y2="637.6563"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="112.1914" x="134.5498" y="647.8667">[sendToRetry fail]</text><g class="message" data-participant-1="SendRetry" data-participant-2="DeadLetter"><polygon fill="#181818" points="1599.5957,668.5938,1609.5957,672.5938,1599.5957,676.5938,1603.5957,672.5938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1341.2285" x2="1605.5957" y1="672.5938" y2="672.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.5459" x="1348.2285" y="667.5278">SendToDeadLetterTopic</text></g><g class="message" data-participant-1="DeadLetter" data-participant-2="SendWithRetry"><polygon fill="#181818" points="715.792,697.7266,705.792,701.7266,715.792,705.7266,711.792,701.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="709.792" x2="1610.5957" y1="701.7266" y2="701.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15.4629" x="721.792" y="696.6606">nil</text></g><g class="message" data-participant-1="SendWithRetry" data-participant-2="Handler"><polygon fill="#181818" points="199.1431,726.8594,189.1431,730.8594,199.1431,734.8594,195.1431,730.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="193.1431" x2="703.792" y1="730.8594" y2="730.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.9858" x="205.1431" y="725.7935">error</text></g><g class="message" data-participant-1="SendWithRetry" data-participant-2="InFlight"><polygon fill="#181818" points="894.9604,762.9922,904.9604,766.9922,894.9604,770.9922,898.9604,766.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="704.792" x2="900.9604" y1="766.9922" y2="766.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.6899" x="711.792" y="761.9263">release</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="109.5498" x2="1782.3647" y1="782.9922" y2="782.9922"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="70.5547" x="114.5498" y="793.2026">[saturated]</text><g class="message" data-participant-1="SendWithRetry" data-participant-2="Handler"><polygon fill="#181818" points="199.1431,813.9297,189.1431,817.9297,199.1431,821.9297,195.1431,817.9297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="193.1431" x2="703.792" y1="817.9297" y2="817.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="331.2588" x="205.1431" y="812.8638">return 503 / internal server (in-flight limit reached)</text></g><path d="M178,837.9297 L178,968.9297 L699,968.9297 L699,847.9297 L689,837.9297 L178,837.9297" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M689,837.9297 L689,847.9297 L699,847.9297 L689,837.9297" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="293.084" x="184" y="854.9966">Kafka Message fields / headers used in code:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303.9194" x="184" y="870.1294">- Key: user ID (binary) or username for deletes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.3105" x="184" y="885.2622">- Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="483.5391" x="200.5293" y="900.395">* HeaderOperation: operation name (e.g. "CREATE", "UPDATE", "DELETE")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="416.4189" x="200.5293" y="915.5278">* HeaderOriginalTimestamp: RFC3339 timestamp when created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="356.5225" x="200.5293" y="930.6606">* HeaderRetryCount: retry count as string ("0", "1", ...)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="463.9502" x="200.5293" y="945.7935">* HeaderRetryError / HeaderNextRetryTS: added when sending to retry</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="485.3228" x="184" y="960.9263">These header names appear as constants in the producer/consumer code.</text><!--SRC=[fLLDRziu4BthLmnyaejOQH7iONKeK3XEKxJP1B6BdXbgR16cI9MadFN- -XrIecHPIJzG7nAAd3SVxms7JZY9y61qqN0qO54LtuGh7z6P8trzRr1nX9GNLRseX1BpX76d3IobGEMIcXadkAYPSZ3xA1JSCbL8D3DWDgx7HbyjcXWky-7ynXrQotOOKElnta_GVR8zjjyP8uMwaM9NkZLML4x9b48v3w1FtSdOVi-sUvPzCy9HfF2lIyW6q6T_7BP_ak16XsGskXQyp_65_4R0TG1U8ok-eAC41lImboIj1h1u7vdEuNQpUO27-_K6BW_lBXloQPFkqDkTSPkJmaOmAVv3yBRUX3CfuKoNv0mNNVLKvr0Rf78GMjfESKCxJL47YbsmdjfqFaL4TNBm6un_RmI5IPLMYoUf-Lwe7VMaTF6eI81-4VL2JAVtg8BH9DOWQWuZoLDFo9sbI1xdezc6SpeCt_utG64nZQc4XBI3p7lCMVnJ7GswngX9b1-mOr0YinXCKLg4BHEoCVYB6Q8nshmUfs_Q7CwREgtixiBZXy82GOFPf8mOOYXyojV4-1McEj-G7WJpj9dZa4VWuJGHpybhMRm_kLivl7W3Hz3Xx0yh65DFThyjDq7QKXbr3Lsd8lcrzlhhxHLSWb1KWsB-rfi3LPCAjTYsjqUAIZYoPhp4OfxuG8dIr44c3CpFU8HQ4zxcoG9E9snjz44KQC4U5I-DLhgnyCJudkQ4jTIMnD393OwNDoCtzmgUmzID7Nm1LJTsTfeyEjtAJ0kI1EWjAaY9XGnIU0TtT2euTKGSfv6rPMCC3SoB_hcxQGFOEJIr7qC5TQwcR5o9yCoEcIyOVBrTrHAt3lJsx9a95mlYQDmAb8KbMalAYiQl7wm5SGDS5-Xf8jBoTjf-keRqIIX6BUlBy7kALUGYr4G5eINxszPF7ZHzqttUrqX22wroq7490PnYjijWjdnSVTYiPXVqi3nSTwlhrPSLhUPZJoGbvI0tWbXshAfpUBnPNbrT_GqkRi5pYLG0zK7ihOWE32nreq9BUbMu__0lbIKLYCjqzjR7VaT_iYoRJz4ht_x4Lxlr3_xhsjcope4L1N4NWljRxDr5zPDDYTJnBScXSWkihf4P7vjhHObJNthYlPfrf_YbFsagWdWv1e7_1m00]--></g></svg>